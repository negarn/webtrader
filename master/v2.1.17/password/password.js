define(["websockets/binary_websockets","windows/windows","common/rivetsExtra","lodash"],function(a,b,c,d){function e(a){a.click(function(){h?h.moveToTop():require(["text!password/password.html"],f)})}function f(a){a=$(a).i18n(),h=b.createBlankWindow(a,{title:"Change password".i18n(),resizable:!1,collapsable:!1,minimizable:!1,maximizable:!1,height:350,"data-authorized":!0,close:function(){h.dialog("destroy"),h.remove(),h=null},open:function(){},destroy:function(){i&&i.unbind(),i=null}}),g(a),h.dialog("open")}function g(b){var e={empty_fields:{validate:!1,clear:d.debounce(function(){e.empty_fields.validate=!1},2e3),show:function(){e.empty_fields.validate=!0,e.empty_fields.clear()}},account:{password:"",new_password:"",verify_password:""},btn:{disabled:!1}};e.password_error_message=function(){var a=e.account.new_password;return""===a?e.empty_fields.validate?"* Please enter your new password".i18n():"":a.length<6?"* Password must be 6 characters minimum".i18n():/\d/.test(a)&&/[a-z]/.test(a)&&/[A-Z]/.test(a)?"":"* Password must contain uppercase letters and numbers".i18n()},e.btn.change=function(){e.empty_fields.show();e.account;if(""!==e.account.password&&""===e.password_error_message()&&e.account.new_password===e.account.verify_password){var b={change_password:1,old_password:e.account.password,new_password:e.account.new_password};e.btn.disabled=!0,a.send(b).then(function(a){if(1!==a.change_password)throw{message:"Failed to update the password".i18n()};e.btn.disabled=!1,$.growl.notice({message:"Password successfully updated.".i18n()}),$.growl.notice({message:"Redirecting to oauth login page,<br/>Please use your new password to login.".i18n()}),require(["oauth/login"],function(a){d.defer(function(){a.login()},1e3)}),h.dialog("close")})["catch"](function(a){e.btn.disabled=!1,$.growl.error({message:a.message})})}},i=c.bind(b[0],e)}require(["text!password/password.html"]),require(["css!password/password.css"]);var h=null,i=null;return{init:e}});