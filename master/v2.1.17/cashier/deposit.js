"use strict";define(["jquery","websockets/binary_websockets","windows/windows","cashier/currency","common/rivetsExtra","lodash","moment"],function(a,b,c,d,e,f){function g(a){a.click(function(){j?j.moveToTop():b.cached.authorize().then(function(a){return a.authorize.currency?!0:d.check_currency()}).then(function(){return require(["text!cashier/deposit.html"],h)})["catch"](l)})}function h(b){b=a(b).i18n(),j=c.createBlankWindow(b,{title:"Deposit funds",resizable:!0,collapsable:!1,minimizable:!0,maximizable:!0,width:700,height:600,"data-authorized":!0,close:function(){j.dialog("destroy"),j.trigger("dialogclose"),j.remove(),j=null},open:function(){},destroy:function(){k&&k.unbind(),k=null}}),i(b),j.dialog("open");var d=j.dialog("widget").offset();d.top=110,j.dialog("option","position",{my:d.left,at:d.top}),j.dialog("widget").css({left:d.left+"px",top:d.top+"px"}),j.fixFooterPosition(),j.track({module_id:"deposit",is_unique:!0})}function i(c){var d=(b.app_id,{route:{value:"standard-methods"},empty_fields:{validate:!1,clear:f.debounce(function(){d.empty_fields.validate=!1},4e3),show:function(){d.empty_fields.validate=!0,d.empty_fields.clear()}},user:{email:local_storage.get("authorize").email,cashier_url:"",residence:"",residence_name:""},standard_methods:{iframe_visible:!1},payment_agents:{list:[],current:{}}});d.route.update=function(a){d.route.value=a},d.standard_methods.iframe_loaded=function(){d.user.cashier_url&&(d.standard_methods.iframe_visible=!0)},d.payment_agents.get_commission_text=function(a){return a.deposit_commission===a.withdrawal_commission?a.deposit_commission+"% "+"commission".i18n():a.deposit_commission+"% "+"deposits".i18n()+" / "+a.withdrawal_commission+"% "+"withdrawals".i18n()},d.payment_agents.onclick=function(b,c){var e=a(c.target).next(),f=d.payment_agents.elem;f&&f.css("max-height","0"),d.payment_agents.current.is_active=!1,d.payment_agents.current===b?d.payment_agents.current={}:(d.payment_agents.current=b,d.payment_agents.elem=e,e.css("max-height",e[0].scrollHeight+"px"),b.is_active=!0)},k=e.bind(c[0],d),b.send({cashier:"deposit"}).then(function(a){d.user.cashier_url=a.cashier})["catch"](l);var g=b.send({get_settings:1}).then(function(a){d.user.residence=a.get_settings.country_code,d.user.residence_name=a.get_settings.country})["catch"](l);g.then(function(){return d.user.residence?b.send({paymentagent_list:d.user.residence}):{paymentagent_list:{list:[]}}}).then(function(a){var b=a.paymentagent_list.list.map(function(a){return a.commission_text=d.payment_agents.get_commission_text(a),a.supported_banks=a.supported_banks.toLowerCase().split(","),a});d.payment_agents.list=b})["catch"](l)}require(["text!cashier/deposit.html"]),require(["css!cashier/deposit.css"]);var j=null,k=null,l=function(b){a.growl.error({message:b.message})};return{init:g}});