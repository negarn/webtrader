{"version":3,"sources":["../../../../src/cashier/currency.es6"],"names":["define","$","liveapi","windows","rv","html","require","check_promise","check_currency","Promise","resolve","reject","$html","win","createBlankWindow","dialogClass","width","height","resizable","collapsable","minimizable","maximizable","modal","ignoreTileAction","close","dialog","remove","destroy","win_view","unbind","state","disabled","value","array","continue","send","set_account_currency","then","cancel","message","i18n","bind","catch","up"],"mappings":";;AAAAA,OAAO,CAAC,QAAD,EAAW,8BAAX,EAA2C,iBAA3C,EAA8D,oBAA9D,EAAoF,4BAApF,CAAP,EAA0H,UAASC,CAAT,EAAYC,OAAZ,EAAqBC,OAArB,EAA8BC,EAA9B,EAAkCC,IAAlC,EAAwC;AAC9JC,UAAQ,CAAC,4BAAD,CAAR;;AAEA,MAAIC,gBAAgB,IAApB;AACA,MAAIC,kBAAiB,SAAjBA,eAAiB;AAAA,WAAM,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxD,UAAIC,QAAQX,EAAEI,IAAF,CAAZ;AACA,UAAIQ,MAAMV,QAAQW,iBAAR,CAA0BF,KAA1B,EAAiC;AACvCG,qBAAa,gBAD0B;AAEvCC,eAAO,GAFgC;AAGvCC,gBAAQ,GAH+B;AAIvCC,mBAAW,KAJ4B;AAKvCC,qBAAa,KAL0B;AAMvCC,qBAAa,KAN0B;AAOvCC,qBAAa,KAP0B;AAQvCC,eAAO,IARgC;AASvCC,0BAAiB,IATsB;AAUvCC,eAAO,iBAAM;AACXX,cAAIY,MAAJ,CAAW,SAAX;AACAZ,cAAIa,MAAJ;AACAb,gBAAM,IAAN;AACD,SAdsC;AAevCc,iBAAS,mBAAM;AACbC,sBAAYA,SAASC,MAAT,EAAZ;AACAD,qBAAW,IAAX;AACD;AAlBsC,OAAjC,CAAV;;AAqBA,UAAIE,QAAQ;AACVC,kBAAU,KADA;AAEVC,eAAO,KAFG;AAGVC,eAAO,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB,CAHG;AAIVC,kBAAU,qBAAM;AACdJ,gBAAMC,QAAN,GAAiB,IAAjB;AACA7B,kBAAQiC,IAAR,CAAa,EAAEC,sBAAsBN,MAAME,KAA9B,EAAb,EACGK,IADH,CACQ3B,OADR,EACiBC,MADjB,EAEG0B,IAFH,CAEQ;AAAA,mBAAMxB,IAAIY,MAAJ,CAAW,OAAX,CAAN;AAAA,WAFR;AAGD,SATS;AAUVa,gBAAQ,kBAAM;AACZzB,cAAIY,MAAJ,CAAW,OAAX;AACAd,iBAAO,EAAE4B,SAAS,uBAAuBC,IAAvB,EAAX,EAAP;AACD;AAbS,OAAZ;;AAgBA,UAAIZ,WAAWxB,GAAGqC,IAAH,CAAQ7B,MAAM,CAAN,CAAR,EAAkBkB,KAAlB,CAAf;AACAjB,UAAIY,MAAJ,CAAW,MAAX;AACH,KAzC0B,CAAN;AAAA,GAArB;;AA2CA,SAAO;AACLjB,oBAAgB,0BAAM;AACpB,UAAGD,aAAH,EAAkB;AAAE,eAAOA,aAAP;AAAuB;AAC3CA,sBAAgBC,kBAAiBkC,KAAjB,CAAuB,cAAM;AAC3CnC,wBAAgB,IAAhB;AACA,cAAMoC,EAAN;AACD,OAHe,CAAhB;AAIA,aAAOpC,aAAP;AACD;AARI,GAAP;AAUH,CAzDD","file":"currency.js","sourcesContent":["define(['jquery', 'websockets/binary_websockets', 'windows/windows', 'common/rivetsExtra', 'text!cashier/currency.html'], function($, liveapi, windows, rv, html) {\n    require(['text!cashier/currency.html']);\n\n    var check_promise = null;\n    var check_currency = () => new Promise((resolve, reject) => {\n        var $html = $(html);\n        var win = windows.createBlankWindow($html, {\n            dialogClass: \"dialog-confirm\",\n            width: 500,\n            height: 230,\n            resizable: false,\n            collapsable: false,\n            minimizable: false,\n            maximizable: false,\n            modal: true,\n            ignoreTileAction:true,\n            close: () => {\n              win.dialog('destroy');\n              win.remove();\n              win = null;\n            },\n            destroy: () => {\n              win_view && win_view.unbind();\n              win_view = null;\n            }\n        });\n\n        var state = {\n          disabled: false,\n          value: 'USD',\n          array: ['USD', 'EUR', 'GBP', 'AUD'],\n          continue: () => {\n            state.disabled = true;\n            liveapi.send({ set_account_currency: state.value })\n              .then(resolve, reject)\n              .then(() => win.dialog('close'));\n          },\n          cancel: () => {\n            win.dialog('close');\n            reject({ message: 'Please set currency.'.i18n() });\n          }\n        };\n\n        var win_view = rv.bind($html[0], state);\n        win.dialog('open');\n    });\n\n    return {\n      check_currency: () => {\n        if(check_promise) { return check_promise; }\n        check_promise = check_currency().catch(up => {\n          check_promise = null;\n          throw up;\n        });\n        return check_promise;\n      }\n    }\n});\n"]}