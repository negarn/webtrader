define(["common/util","highstock"],function(){function a(){var a=this;this.yAxis.plotLinesAndBands.forEach(function(b){return b.options.id&&0==b.options.id.indexOf(a.options.id+"_CurrentPrice")?(a.yAxis.removePlotLine(b.options.id),!1):void 0})}return{init:function(){!function(b,c){function d(){var a=this,b=a.options.data[a.data.length-1],d=this.yAxis;c.each(d.plotLinesAndBands,function(c,d){var f=d.options;if(f.id&&0==f.id.indexOf(a.options.id+"_CurrentPrice")){a.yAxis.removePlotLine(f.id);var g=b.y||b.close||b[4]||b[1];return e.call(a,f,g),!1}})}function e(a,b){var d=this.chart.series.length+1,e=!1;this.data[this.data.length-1]&&(c.isNumeric(this.data[this.data.length-1].change)&&(e=!0,b=toFixed(this.data[this.data.length-1].change,2)),this.yAxis.addPlotLine({id:this.options.id+"_CurrentPrice_"+Date.now(),color:a.stroke||a.color,dashStyle:a.dashStyle,width:a.strokeWidth||a.width,value:b,zIndex:d,textAlign:"left",label:{text:b+(e?"%":""),style:{background:"#2E8836",color:"white",padding:"2px 2px 2px 2px"},x:-40,y:4,useHTML:!0}}))}b&&!b.Series.prototype.addCurrentPrice&&(b.Series.prototype.addCurrentPrice=function(a){var b=this.options.id;a=c.extend({stroke:"red",strokeWidth:1,dashStyle:"dash",parentSeriesID:b},a);var d=this.data||[];if(d&&d.length>0){var f=d[d.length-1],g=f.y||f.close||f[4];g>0&&e.call(this,a,g)}},b.Series.prototype.removeCurrentPrice=function(){a.call(this)},b.wrap(b.Series.prototype,"addPoint",function(a,b,c,e,f){a.call(this,b,c,e,f),d.call(this,b[0])}),b.wrap(b.Point.prototype,"update",function(a,b,c,e){a.call(this,b,c,e);var f=this.series;d.call(f,this.x,!0)}))}(Highcharts,jQuery)}}});