define(["module","jquery","windows/windows","websockets/binary_websockets","lodash","datatables","jquery-growl"],function(a,b,c,d,e){function f(a){require(["css!statement/statement.css"]),require(["text!statement/statement.html"]),a.click(function(){i?i.moveToTop():d.cached.authorize().then(h)["catch"](function(a){})})}function g(a){var c=b("#"+j.attr("id")+"_processing").css("top","200px").show();m=!0;var f={statement:1,description:1};if("string"==typeof a){f.date_from=yyyy_mm_dd_to_epoch(a,{utc:!0});var g=Date.UTC(1970,0,1,23,59,59)/1e3;f.date_to=f.date_from+g,j.api().rows().remove(),n=!0}else f.limit=50,(n||a.clear)&&(j.api().rows().remove(),n=!1),f.offset=j.api().column(0).data().length;var h=function(a){var b=a.statement&&a.statement.transactions||[],d="View".i18n(),f=b.map(function(a){{var b=e(["buy","sell"]).includes(a.action_type)?"":'class="button-disabled"',c="<button "+b+">"+d+"</button>";1*a.amount}return[epoch_to_string(a.transaction_time,{utc:!0}),a.transaction_id,e.capitalize(a.action_type),a.longcode,(1*a.amount).toFixed(2),"<b>"+formatPrice(a.balance_after,l)+"</b>",c,a]});j.api().rows.add(f),j.api().draw(),m=!1,c.hide()};d.send(f).then(h)["catch"](function(a){h({}),b.growl.error({message:a.message})})}function h(){i=c.createBlankWindow(b("<div/>"),{title:"Statement".i18n(),width:700,height:400,destroy:function(){j&&j.DataTable().destroy(!0),i=null},refresh:function(){k.clear(),g({clear:!0})},"data-authorized":"true"}),i.track({module_id:"statement",is_unique:!0,data:null}),require(["text!statement/statement.html"],function(a){j=b(a).i18n(),j.appendTo(i),j=j.dataTable({data:[],columnDefs:[{targets:4,createdCell:function(a,c){var d=0>c?"red":c>0?"green":"bold";d&&b(a).addClass(d),a.textContent=formatPrice(c,l)}}],paging:!1,ordering:!1,searching:!0,processing:!0}),j.closest(".ui-dialog-content").addClass("hide-search-input").addClass("statement-dialog-content"),j.api().columns().every(function(){var a=this;b("input",this.header()).on("keyup change",function(){a.search()!==this.value&&a.search(this.value).draw()})}),k=i.addDateToHeader({title:"Jump to: ",date:null,changed:g,cleared:g}),i.on("click",o),i.dialog("open"),g({clear:!0}),i.scroll(function(){var a=i.scrollTop(),b=i.innerHeight(),c=i[0].scrollHeight,d=(a+b)/c;d>.75&&!m&&!n&&g({clear:!1})})})}var i=null,j=null,k=null,l=local_storage.get("currency"),m=!1,n=!1,o=function(a){var c=a.target,d=b(c);if("BUTTON"===c.tagName&&!d.hasClass("button-disabled")){var f=c.parentElement.parentElement,g=j.api().row(f).data();g=e.last(g),d.addClass("button-disabled"),require(["viewtransaction/viewTransaction"],function(a){a.init(g.contract_id,g.transaction_id).then(function(){d.removeClass("button-disabled")})})}};return{init:f}});