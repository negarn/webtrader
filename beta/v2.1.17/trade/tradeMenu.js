define(["jquery","lodash","websockets/binary_websockets","navigation/menu","jquery-growl"],function(a,b,c,d){function e(){c.send({active_symbols:"brief"}).then(function(b){var e=_(b.active_symbols).groupBy("market").map(function(a){var b=_.head(a),c={name:b.market,display_name:b.market_display_name};return c.submarkets=_(a).groupBy("submarket").map(function(a){var b=_.head(a),c={name:b.submarket,display_name:b.submarket_display_name};return c.instruments=_.map(a,function(a){return{symbol:a.symbol,display_name:a.display_name,is_disabled:a.is_trading_suspended||!a.exchange_is_open,pip:a.pip}}),c.is_disabled=_.every(c.instruments,"is_disabled"),c}).value(),c.is_disabled=_.every(c.submarkets,"is_disabled"),c}).value();e=d.sortMenu(e);var f=a("#nav-menu").find(".trade");f.find("> ul").remove();var h=a("<ul>").appendTo(f);d.refreshMenu(h,e,function(a){var b=a.data();c.send({contracts_for:b.symbol}).then(function(a){require(["trade/tradeDialog"],function(c){c.init(b,a.contracts_for)})})["catch"](g)})})["catch"](g)}function f(){require(["trade/tradeDialog"]),e(),require(["websockets/binary_websockets"],function(a){a.events.on("login",e),a.events.on("logout",e)});a("#nav-menu").find(".trade").on("mouseleave",e)}var g=function(b){a.growl.error({message:b.message})};return{init:f}});